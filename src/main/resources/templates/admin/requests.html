<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
				xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Users Requests</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body sec:authorize="hasRole('ADMIN') and principal.isSuperAdmin()">
	<!-- Navbar -->
	<div th:replace="~{fragments/navbar :: navbar('requests')}"></div>
	
	<!-- Title -->
    <div class="functions-section">
        <h3 class="m-3">Users Requests</h3>
    </div>

    <!-- Users Requests List -->
    <div class="container-fluid mt-3">
    
    	<!-- Filters -->
    	<div class="filter-section ms-2 d-flex justify-content-start align-items-center mb-3">
    		<form th:action="@{/admins/requests}" method="get" class="row align-items-end">
	            <!-- Roles -->
	            <div class="col-auto">
	                <label for="roleFilter" class="form-label mb-0">Filter by Role:</label>
	                <select name="roleName" class="form-select" style="width: 200px;">
	                    <option value="" th:selected="${roleName == null}">All Roles</option>
	                    <option th:each="role : ${roles}"
	                    		th:value="${role}"
	                    		th:text="${role}"
	                    		th:selected="${roleName == role}"></option>
	                </select>
	            </div>
	            <!-- Search -->
	            <div class="col-auto">
	                <label for="searchInput" class="form-label mb-0">Search:</label>
	                <input type="text" name="search" class="form-control" placeholder="Search by name or email" 
	                	   style="width: 300px;" autocomplete="off" th:value="${search}">
	            </div>
	            <!-- Buttons -->
		        <div class="col-auto d-flex">
		            <button type="submit" class="btn btn-outline-dark me-2">Filter</button>
		            <a th:href="@{/admins/requests}" class="btn btn-outline-secondary me-2">Reset</a>
		        </div>
            </form>
    	</div>
    
        <!-- Table -->
        <div class="card mb-3">
            <div class="card-header text-center">
                <h5>List of Requests</h5>
            </div>
            
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover text-center">
                        <thead>
                            <tr>
                            	<th>ID</th>
                                <th>Email</th>
                                <th>Full Name</th>
                                <th>Mobile</th>
                                <th>Role</th>
                                <th>Registered At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr th:each="req : ${requestsFixed}">
							    <td th:text="${req != null ? req.id : '—'}"></td>
							    <td th:text="${req != null ? req.email : '—'}"></td>
							    <td th:text="${req != null ? req.fullName : '—'}"></td>
							    <td th:text="${req != null ? req.mobile : '—'}"></td>
							    <td th:text="${req != null && req.role != null ? req.role.name : '—'}"></td>
							    <td th:text="${req != null ? #temporals.format(req.registeredAt, 'yyyy-MM-dd HH:mm') : '—'}"></td>
							    <td>
							        <div th:if="${req != null}">
							            <!-- Accept Button -->
							            <form th:action="@{/admins/requests/approve/{id}(id=${req.id})}" method="post" style="display:inline;">
							                <button class="btn btn-sm btn-outline-dark me-1" type="submit">Approve</button>
							            </form>
							            <!-- Reject Button -->
							            <form th:action="@{/admins/requests/reject/{id}(id=${req.id})}" method="post" style="display:inline;">
							                <button class="btn btn-sm btn-outline-danger" type="submit">Reject</button>
							            </form>
							        </div>
							        <div th:if="${req == null}">
							        	<!-- Accept Button - Disabled -->
							        	<button class="btn btn-sm btn-outline-dark me-1" disabled>Approve</button>
                                        <!-- Reject Button - Disabled -->
                                        <button class="btn btn-sm btn-outline-danger" disabled>Reject</button>
							        </div>
							    </td>
							</tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
	            <nav aria-label="Users pagination" class="mt-3">
	            	<ul class="pagination justify-content-center">
	            		<!-- Previous Button -->
	            		<li th:classappend="${currentPage == 0} ? 'disabled'" class="page-item" >
	            			<a th:href="@{/admins/requests(
	            						page=${currentPage-1},
	            						search=${search},
	            						roleName=${roleName}
                       			        )}"	 
	            				class="page-link" 
	            				tabindex="-1">Previous</a>
	            		</li>
	            		<!-- Number of Page -->
	            		<li class="page-item"
	            			th:each="i : ${#numbers.sequence(0, totalPages-1)}"
	            			th:classappend="${i == currentPage} ? 'active'">
	            			<a class="page-link" 
	            			   th:href="@{/admins/requests(
	            						page=${i},
	            						search=${search},
	            						roleName=${roleName}
                       			        )}"	
	            			   th:text="${i + 1}">1</a>
	            		</li>
	            		<!-- Next Button -->
	            		<li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
	            			<a class="page-link" th:href="@{/admins/requests(
	            						page=${currentPage + 1},
	            						search=${search},
	            						roleName=${roleName}
	            						)}">Next</a>
	            		</li>
	            	</ul>
	            </nav>
            </div>
        </div>
    </div>
	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>